#!/bin/bash

usage="$(basename "$0") [-h] [--save_test_output] -- Run tests on real hardware

Options:
    -h                  Show this help message and exit
    --save_test_output  Save the output files generated by this script, set to false by default"

SAVE_TEST_OUTPUT="false"

while [[ $# -gt 0 ]]; do
    case $1 in
        -h)
            echo "${usage}"
            exit 0
            ;;
        --save_test_output)
            SAVE_TEST_OUTPUT="true"
            shift
            ;;
        *)
            echo "Unknown argument $1"
            exit 1
            ;;
    esac
done

if [[ ! -e "`dirname "$0"`/PIC16F84A" ]]; then
    echo "Executable PIC16F84A does not exist."
    exit 1
fi

sudo `dirname "$0"`/PIC16F84A testing
python3 `dirname "$0"`/test_data/verify_real_hw_result.py `dirname "$0"`/test_data
if [[ "${SAVE_TEST_OUTPUT}" == "false" ]]; then
    rm -f `dirname "$0"`/test_data/real_hw_tb_result.txt
fi
